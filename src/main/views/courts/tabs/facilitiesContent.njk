{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/panel/macro.njk" import govukPanel %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "govuk/components/select/macro.njk" import govukSelect %}

<h2 class="govuk-heading-l">Facilities</h2>

{% if errors|length %}
  {{ govukErrorSummary({
    titleText: "There is a problem",
    errorList: errors
  }) }}
{% endif %}

{% if updated === true %}
  {{ govukPanel({
    titleText: "Court Facilities updated"
  }) }}
{% endif %}

{% for facility in courtFacilities %}
  {% set isNew = (facility.isNew === true) or (facility.isNew === "true") %}

  {% set nameError = false %}
  {% if facility.name === '' %}
    {% set nameError = { text: 'Name is required' } %}
  {% elif facility.isDuplicated === true %}
    {% set nameError = { text: 'Duplicated facility' } %}
  {% endif %}

  {% call govukFieldset({
  }) %}

  {% if isNew === true%}
    <h3 class="govuk-heading-s">Add New Court Facility</h3>
  {% endif %}

  <input type="hidden" name={{"courtFacilities[" + loop.index +"][isNew]"}} value={{courtFacilities.isNew}}></input>

  {{ govukSelect({
    id: "name-" + loop.index,
    name: "courtFacilities[" + loop.index +"][name]",
    label: {
        text: "Name"
    },
    errorMessage: nameError,
    items: facilitiesTypes | selectFilter(facility.name)
  }) }}

  <div class="govuk-form-group">
    <h2 class="govuk-label-wrapper">
      <label class="govuk-label">Description</label>
    </h2>
    <textarea class="govuk-textarea rich-editor" id="description-{{ loop.index }}"   name="courtFacilities[{{ loop.index }}][description]"
              rows="3">{{ facility.description }}</textarea>
  </div>

  <div class="govuk-form-group">
    <h2 class="govuk-label-wrapper">
      <label class="govuk-label">Description (Welsh)</label>
    </h2>
    <textarea class="govuk-textarea rich-editor"  id="descriptionCy-{{ loop.index }}"  name="courtFacilities[{{ loop.index }}][descriptionCy]"
              rows="3">{{ facility.descriptionCy }}</textarea>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      {% if isNew === false %}
          {{ govukButton({
              text: "Remove",
              name: "deleteFacility",
              type: "button",
              classes: "govuk-button--warning deleteFacility"
          }) }}
      {% endif %}

      {% if isNew === true %}
        {{ govukButton({
          text: "Clear",
          name: "clearFacility",
          type: "button",
          classes: "govuk-button--secondary clearFacility"
        }) }}
      {% endif %}
    </div>
  </div>

  <hr/>

  {% endcall %}

{% endfor %}


{% call govukFieldset({
  attributes: { id: "newFacilityTemplate", disabled: "disabled", hidden: true }
}) %}

 <h3 class="govuk-heading-s">Add New Court Facility</h3>

 <input type="hidden" name={{"courtFacilities[" + courtFacilities.length +"][isNew]"}} value="true"></input>

 {{ govukSelect({
    id: "name-" + courtFacilities.length,
    name: "courtFacilities[" + courtFacilities.length +"][name]",
    label: {
      text: "Name"
    },
    items: facilitiesTypes | selectFilter('')
  }) }}

  <div class="govuk-form-group">
    <h2 class="govuk-label-wrapper">
      <label class="govuk-label">Description</label>
    </h2>
    <textarea class="govuk-textarea rich-editor" id="description-{{ courtFacilities.length }}" name="courtFacilities[{{ courtFacilities.length }}][description]"
              rows="3"></textarea>
  </div>

  <div class="govuk-form-group">
    <h2 class="govuk-label-wrapper">
      <label class="govuk-label">Description (Welsh)</label>
    </h2>
    <textarea class="govuk-textarea rich-editor"  id="descriptionCy-{{ courtFacilities.length }}" name="courtFacilities[{{ courtFacilities.length }}][descriptionCy]"
              rows="3"></textarea>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
       {{ govukButton({
            text: "Clear",
            name: "clearFacility",
            type: "button",
            classes: "govuk-button--secondary clearFacility"
       }) }}
    </div>
  </div>

  <hr/>

{% endcall %}

{{ govukButton({
  text: "Save",
  name: "saveFacilities"
}) }}

{{ govukButton({
  text: "Add new facility",
  name: "addFacility",
  type: "button",
  classes: "govuk-button--secondary addFacility"
}) }}


