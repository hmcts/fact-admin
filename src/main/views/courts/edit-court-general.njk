{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "macros/tabs/macro.njk" import factTabs %}

{% extends "template.njk" %}

{% block pageTitle %}
  Edit Court
{% endblock %}

{% block beforeContent %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      <a id="courts" class="govuk-link govuk-link--no-visited-state" href="/courts">courts</a>
    </div>

    <div class="govuk-grid-column-one-quarter">
      <a id="my-account" class="govuk-link govuk-link--no-visited-state" href="#">my account</a>
      <a id="logout" class="govuk-link govuk-link--no-visited-state" href="/logout">log out</a>
    </div>
  </div>

{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% if updated %}
        <div class="govuk-panel govuk-panel--confirmation" id="updated-message">
          <h1 class="govuk-panel__title">
            Court information updated
          </h1>
        </div>
      {% endif %}
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
          <h1 id="court-name" class="govuk-heading-l">Editing - {{ name }}</h1>
        </div>

        <div class="govuk-grid-column-one-quarter">
          <a id="view-in-new-window" class="govuk-link" rel="noreferrer noopener" target="_blank"
            href="{{ factFrontendURL }}/courts/{{ slug }}">View court in new tab</a>
        </div>
      </div>

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% set generalHtml %}
              {% include "./tabs/general.njk" %}
            {% endset -%}
            {% set openingHoursHtml %}
              {% include "./tabs/openingHours.njk" %}
            {% endset -%}
            {% set phoneNumbersHtml %}
               {% include "./tabs/phoneNumbers.njk" %}
            {% endset -%}
            {% set emailsHtml %}
               {% include "./tabs/emails.njk" %}
            {% endset -%}
            {% set courtTypesHtml %}
                {% include "./tabs/types.njk" %}
            {% endset -%}
            {% set courtFacilitiesHtml %}
              {% include "./tabs/facilities.njk" %}
            {% endset -%}
            {% if featureFlags.values[featureFlags.flags.FACT_ADMIN_TEST] %}
              {% set postcodesHtml %}
                  {% include "./tabs/postcodes.njk" %}
              {% endset -%}
            {% endif %}
            {% set localAuthoritiesHtml %}
                {% include "./tabs/localAuthorities.njk" %}
            {% endset -%}
            {% set casesHeardHtml %}
                {% include "./tabs/casesHeard.njk" %}
            {% endset -%}
            {% set addressesHtml %}
                {% include "./tabs/addresses.njk" %}
            {% endset -%}
            {% set photoHtml %}
                {% include "./tabs/photo.njk" %}
            {% endset -%}
            {% set additionalLinksHtml %}
              {% include "./tabs/additionalLinks.njk" %}
            {% endset -%}
            {% set spoeHtml %}
              {% include "./tabs/spoe.njk" %}
            {% endset -%}
            {% set applicationProgressionHtml %}
              {% include "./tabs/applicationProgression.njk" %}
            {% endset -%}

             <input id='slug' type='hidden' value='{{slug}}'></input>

             {% set tabItems = [
                  {
                    label: "General",
                    id: "general",
                    panel: {
                      html: generalHtml
                    }
                  },
                  {
                    label: "Opening Hours",
                    id: "opening-hours",
                    panel: {
                      html: openingHoursHtml
                    }
                  },
                  {
                    label: "Phone Numbers",
                    id: "phone-numbers",
                    panel: {
                      html: phoneNumbersHtml
                    }
                  },
                  {
                    label: "Emails",
                    id: "emails",
                    panel: {
                      html: emailsHtml
                    }
                  },
                  {
                    label: "Types",
                    id: "court-types",
                    panel: {
                      html: courtTypesHtml
                    }
                  },
                  {
                    label: "Cases Heard",
                    id: "cases-heard",
                    panel: {
                      html: casesHeardHtml
                    }
                  },
                  {
                    label: "Addresses",
                    id: "addresses",
                    panel: {
                      html: addressesHtml
                    }
                  },
                  {
                    label: "Facilities",
                    id: "court-facilities",
                    panel: {
                      html: courtFacilitiesHtml
                    }
                  },
                  {
                    label: "Photo",
                    id: "photo",
                    panel: {
                      html: photoHtml
                    }
                  },
                  {
                    label: "Application Progression",
                    id: "application-progression",
                    panel: {
                      html: applicationProgressionHtml
                    }
                  }
                ]%}

              {% if featureFlags.values[featureFlags.flags.FACT_ADMIN_TEST] %}
                {% set postcodesTab =
                    {
                    label: "Postcodes",
                    id: "postcodes",
                    panel: {
                        html: postcodesHtml
                    }
                    }
                %}
              {% endif %}

              {% set localAuthoritiesTab =
                  {
                    label: "Local Authorities",
                    id: "local-authorities",
                    panel: {
                      html: localAuthoritiesHtml
                    }
                  }
              %}

              {% set additionalLinksTab =
                {
                  label: "Additional Links",
                  id: "additional-links",
                  panel: {
                    html: additionalLinksHtml
                  }
                }
              %}

              {% set spoeTab =
                  {
                    label: "SPoE",
                    id: "spoe",
                    panel: {
                      html: spoeHtml
                    }
                  }
              %}

        {% if isSuperAdmin %}

          {% set tabItems = (tabItems.push(postcodesTab),tabItems) %}
          {% set tabItems = (tabItems.push(localAuthoritiesTab),tabItems) %}
          {% set tabItems = (tabItems.push(additionalLinksTab),tabItems) %}
          {% set tabItems = (tabItems.push(spoeTab),tabItems) %}

        {% endif %}

          {{ factTabs({
            id: 'Main',
            items: tabItems
          }) }}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
